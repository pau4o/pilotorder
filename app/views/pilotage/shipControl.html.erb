<section>
  <h2 class="page-title"><span>Ship Control</span></h2>
  <table cellpadding="0" cellspacing="0">
    <tr> 
      <td>
        <table cellpadding=0 cellspacing=0>
          <tr> 
            <th><%#= messages.getString("Area") %></th>
            <th><%#= messages.getString("ShipsNumber") %></th>
          </tr>
          <logic:iterate collection="<%#= shash %>" id="ar" type="java.util.Map.Entry"> 
            <tr>
              <td>
                <a href="<%#=request.getContextPath() %>/mapControl?AreaID=<bean:write  name="ar" property="value" />"> 
                  <%# String icon=beanManager.getHandy().getAreaIconName(((Integer)ar.getValue()).intValue()); 
                      if ((icon != null) && (! icon.equals("")) ) { %>
                  <img src="images/<%#= icon %>" border="0" alt="MAP"> 
                  <%# } else { out.print("Map"); } %>
                </a>
                <a href="<%#=request.getContextPath()%>/viewArea?AreaID=<bean:write  name="ar" property="value" />"> 
                  <bean:write  name="ar" property="key" />
                </a>
              </td>
              <td> 
                <%# ships=beanManager.getHandy().getShipsNumber(((Integer)ar.getValue()).intValue()); %>
                <%#= ships %>
              </td>
            <tr> 
              <%# total += ships; %>
          </logic:iterate> 
          <tr>
            <td>Total:</td>
            <td><%#= total %></td>
          </tr>
        </table>
      </td>
      <td>
        <table cellpadding=0 cellspacing=0>
          <tr>
            <td colspan="4">Pegel Data</td>
          </tr>
          <tr>
            <td>Point</td>
            <td>Level</td>
            <td>Dispatcher</td>
            <td>Date/Time</td>
          </tr>
          <logic:iterate collection="<%#= beanManager.getHandy().getOptOfPegels()%>" id="peg" type="java.util.Map.Entry"> 
            <tr>
              <td><bean:write name="peg" property="key"/></td>
              <%# int pegelvalue=beanManager.getHandy().getPegel(((Integer)peg.getValue()).intValue()); %>
              <td><%#=(pegelvalue>0)?"+":""%><%#=pegelvalue%></td>
              <td> 
                <address>
                  <%#= beanManager.getHandy().getPlayerFullName(beanManager.getHandy().getPegelEditorID(((Integer)peg.getValue()).intValue())) %> 
                </address>
              </td>
              <td> 
                <address>
                  <%#= beanManager.getHandy().getPegelTime(((Integer)peg.getValue()).intValue()) %> 
                </address>
              </td>
            </tr>
          </logic:iterate> 
          <%# if (request.isUserInRole("DISPATCHER")) { %>
          <tr>
            <td colspan="4"> 
              <a href="<%#= request.getContextPath() %>/editAgent" >Edit agency list</a> 
            </td>
          </tr>
          <%# } %>
          <tr>
            <td colspan="4"> 
              <%# if (request.isUserInRole("DISPATCHER")) { %>
              <form method="POST" action="<%#= request.getContextPath() %>/editPegel">
                <%#= messages.getString("Pegel") %> 
                <select name="pegelID"  >
                  <logic:iterate collection="<%#= beanManager.getHandy().getOptOfPegels() %>" id="mh" type="java.util.Map.Entry">
                    <option value="<bean:write name="mh" property="value" />" > <bean:write name="mh" property="key" /> 
                  </logic:iterate> 
                </select>
                <input type="text" name="pegel" value="0" size="4" />cm 
                <input type="submit" value="Save" name="editPegel" />
              </form>
              <%# } %>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</section>
